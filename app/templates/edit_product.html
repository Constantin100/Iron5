<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редактировать продукт</title>
    <link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="/static/favicon_io/site.webmanifest">
    <style>
        body {
            background: url('/static/images/background.jpg') center/cover fixed;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            font-family: 'Play', sans-serif;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="breadcrumb">
            <a href="{{ url_for('main.admin') }}">Админ-панель</a> / Редактировать продукт
        </div>

        <h2>Редактировать продукт</h2>
        
        <form method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="name">Название продукта:</label>
                <input type="text" 
                       id="name" 
                       name="name" 
                       class="form-control" 
                       value="{{ product.name }}"
                       required>
            </div>
            
            <div class="form-group">
                <label for="description">Описание продукта:</label>
                <textarea id="description" 
                          name="description" 
                          class="form-control" 
                          rows="5" 
                          required>{{ product.description }}</textarea>
            </div>
            
            <div class="form-group">
                <label for="price">Цена:</label>
                <input type="number" 
                       id="price" 
                       name="price" 
                       class="form-control" 
                       value="{{ product.price }}"
                       step="0.01" 
                       required>
            </div>
            
            <div class="form-group">
                <label for="quantity">Количество на складе:</label>
                <input type="number" 
                       id="quantity" 
                       name="quantity" 
                       class="form-control" 
                       value="{{ product.quantity }}"
                       required>
            </div>
            
            <div class="form-group">
                <label for="in_stock">Наличие:</label>
                <select id="in_stock" name="in_stock" class="form-control" required>
                    <option value="В наличии" {% if product.in_stock == 'В наличии' %}selected{% endif %}>В наличии</option>
                    <option value="Под заказ" {% if product.in_stock == 'Под заказ' %}selected{% endif %}>Под заказ</option>
                    <option value="Нет в наличии" {% if product.in_stock == 'Нет в наличии' %}selected{% endif %}>Нет в наличии</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="category">Категория:</label>
                <select id="category" name="category" class="form-control" required>
                    <option value="Ножи" {% if product.category == 'Ножи' %}selected{% endif %}>Ножи</option>
                    <option value="Топоры" {% if product.category == 'Топоры' %}selected{% endif %}>Топоры</option>
                    <option value="Сувениры" {% if product.category == 'Сувениры' %}selected{% endif %}>Сувениры</option>
                    <option value="Ковка в интерьер" {% if product.category == 'Ковка в интерьер' %}selected{% endif %}>Ковка в интерьер</option>
                </select>
            </div>

            {% if product.images %}
            <div class="current-images">
                <label>Текущие изображения:</label>
                <div class="image-grid">
                    {% for image in product.images %}
                    <div class="image-item">
                        <img src="{{ url_for('static', filename='uploads/' + image.filename) }}" alt="{{ product.name }}">
                        <button type="button" 
                                class="delete-image" 
                                data-image-id="{{ image.id }}"
                                onclick="deleteImage({{ image.id }})">×</button>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <div class="form-group">
                <label for="images">Добавить изображения:</label>
                <input type="file" 
                       id="images" 
                       name="images" 
                       class="form-control" 
                       multiple 
                       accept="image/*">
                <small style="color: #888; margin-top: 5px; display: block;">Можно выбрать несколько изображений</small>
            </div>
            
            <div class="button-container">
                <a href="{{ url_for('main.admin') }}" class="back-btn">Назад</a>
                <button type="submit" class="submit-btn">Сохранить изменения</button>
            </div>
        </form>
    </div>

    <script>
    function deleteImage(imageId) {
        if (confirm('Вы уверены, что хотите удалить это изображение?')) {
            fetch(`/delete_image/${imageId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const imageElement = document.querySelector(`[data-image-id="${imageId}"]`).parentElement;
                    imageElement.remove();
                }
            })
            .catch(error => console.error('Error:', error));
        }
    }
    </script>
</body>
</html>